<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.makeu.up.sales.service.SalesMapper">
	<select id="salesByYear" resultType="co.makeu.up.sales.service.SalesVO">
		SELECT TO_CHAR(REG_DATE,'YYYY') YEAR, SUM(PAY) PAY, COUNT(*) CNT
		FROM SUGANG
		WHERE TLSN_ST_CODE != 'SU03'
		GROUP BY ROLLUP(TO_CHAR(REG_DATE,'YYYY'))
		ORDER BY YEAR
	</select>
	<select id="salesByMonth" parameterType="String" resultType="co.makeu.up.sales.service.SalesVO">
		SELECT M.MONTH,S.* 
		FROM (SELECT TO_CHAR(REG_DATE,'MM') MON, SUM(PAY) PAY, COUNT(TLSN_NO) CNT
				FROM SUGANG
				WHERE TO_CHAR(REG_DATE,'YYYY') = #{selectYear}
				AND TLSN_ST_CODE != 'SU03'
				GROUP BY ROLLUP(TO_CHAR(REG_DATE,'MM'))) S 
	        	FULL OUTER JOIN (SELECT LPAD(LEVEL,2,0) MONTH FROM DUAL
        						CONNECT BY LEVEL <![CDATA[<=]]> 12) M
        		ON S.MON = M.MONTH
        ORDER BY M.MONTH
	</select>
	<select id="salesByCtgrYear" resultType="co.makeu.up.sales.service.SalesVO">
		SELECT L.UP_CTGR, TO_CHAR(REG_DATE,'YYYY') YEAR,COUNT(S.TLSN_NO) CNT, SUM(S.PAY) PAY
        FROM SUGANG S JOIN LECTURE L
        ON S.LT_NO = L.LT_NO
        WHERE S.TLSN_ST_CODE != 'SU03' 
        GROUP BY ROLLUP(L.UP_CTGR,TO_CHAR(REG_DATE,'YYYY'))
	</select>
</mapper>