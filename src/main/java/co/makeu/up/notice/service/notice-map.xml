<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.makeu.up.notice.service.NoticeMapper">
	<select id="NoticeList" resultType="co.makeu.up.notice.service.NoticeVO" parameterType="co.makeu.up.notice.service.NoticeVO">	
		SELECT * FROM(
			SELECT ROWNUM RN, NT_NO,WR_DATE,TTL,CONTENT,HITS,LT_NO,FILE_NO,MOD_DATE
			FROM NOTICE 
			WHERE ROWNUM <![CDATA[<=]]> #{page} * 10	
			AND NT_ST_CODE = 'B01'
			AND LT_NO = #{ltNo}
			AND (TTL LIKE '%'||#{ttlSearchKey}||'%'
			AND CONTENT LIKE '%'||#{contentSearchKey}||'%')
			ORDER BY NT_NO DESC)
		WHERE RN <![CDATA[>]]> (#{page}-1) * 10
		ORDER BY NT_NO DESC
	</select>
  
	<select id="NoticeListCnt" parameterType="Integer" resultType="Integer">
		SELECT COUNT(*) FROM NOTICE
		WHERE LT_NO = #{ltNo}
		AND NT_ST_CODE = 'B01'
	</select>
	
	<select id="NoticeSelect" resultType="co.makeu.up.notice.service.NoticeVO" parameterType="co.makeu.up.notice.service.NoticeVO">
		SELECT N.* FROM 
		NOTICE N LEFT OUTER JOIN DETA_FILE F
		ON N.FILE_NO = F.FILE_NO
		WHERE NT_NO = #{ntNo}
	</select>
	
	<update id="updateHits" parameterType="Integer">
		UPDATE NOTICE
		SET HITS = NVL(HITS,0) + 1
	</update>
	<insert id="insertNotice" parameterType="co.makeu.up.notice.service.NoticeVO">
		INSERT INTO NOTICE(NT_NO, WR_DATE, TTL, CONTENT, HITS, LT_NO)
		VALUES((SELECT NVL(MAX(NT_NO), 0)+1 FROM NOTICE), SYSDATE, #{ttl}, #{content}, 0, #{ltNo})
		<!-- 
		(SELECT NVL(MAX(FILE_NO), 0)+1 FROM NOTICE))	
		 --> 
	</insert>
	<select id="noticeFiles" parameterType="Integer" resultType="co.makeu.up.files.service.FilesVO">
		SELECT F.*,D.FILE_PATH,D.PHY_PATH FROM FILES F JOIN DETA_FILE D
        ON F.FILE_NO = D.FILE_NO
        WHERE F.FILE_NO = #{ltNo}
	</select>
</mapper>