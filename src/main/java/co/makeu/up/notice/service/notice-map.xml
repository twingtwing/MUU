<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.makeu.up.notice.service.NoticeMapper">
	<select id="NoticeList" resultType="co.makeu.up.notice.service.NoticeVO" parameterType="co.makeu.up.notice.service.NoticeVO">	
		SELECT * FROM(
            select ROWNUM RN, w.* from(
                select rownum noticeNo, q.* from
                    (SELECT NT_NO,WR_DATE,TTL,CONTENT,HITS,LT_NO,FILE_NO,MOD_DATE, COUNT(*) OVER() AS COUNT
                    FROM NOTICE 
                    where NT_ST_CODE = 'B01'
                    AND LT_NO = #{ltNo}
                    AND (TTL LIKE '%'||#{ttlSearchKey}||'%'
                    AND CONTENT LIKE '%'||#{contentSearchKey}||'%')
                    ORDER BY NT_NO) q
                order by noticeNo desc) w
			WHERE ROWNUM <![CDATA[<=]]> 10*(#{page}))
		WHERE RN <![CDATA[>]]> (#{page}-1)*10
	</select>
  
	<select id="NoticeListCnt" parameterType="Integer" resultType="Integer">
		SELECT COUNT(*) FROM NOTICE
		WHERE LT_NO = #{ltNo}
		AND NT_ST_CODE = 'B01'
	</select>
	
	<select id="NoticeSelect" resultType="co.makeu.up.notice.service.NoticeVO" parameterType="co.makeu.up.notice.service.NoticeVO">
		SELECT N.* FROM 
		NOTICE N LEFT OUTER JOIN DETA_FILE F
		ON N.FILE_NO = F.FILE_NO
		WHERE NT_NO = #{ntNo}
	</select>
	
	<update id="updateHits" parameterType="Integer">
		UPDATE NOTICE
		SET HITS = NVL(#{hits},0) + 1
		WHERE NT_NO = #{ntNo}
	</update>
	<insert id="insertNotice" parameterType="co.makeu.up.notice.service.NoticeVO">
		INSERT INTO NOTICE(NT_NO, WR_DATE, TTL, CONTENT, HITS, LT_NO, NT_ST_CODE)
		VALUES((SELECT NVL(MAX(NT_NO), 0)+1 FROM NOTICE), SYSDATE, #{ttl}, #{content}, 0, #{ltNo}, 'B01')
		<!-- 
		(SELECT NVL(MAX(FILE_NO), 0)+1 FROM NOTICE))	
		 --> 
	</insert>
	<delete id="deleteNotice" parameterType="co.makeu.up.notice.service.NoticeVO">
		DELETE FROM NOTICE
		WHERE NT_NO = #{ntNo}
	</delete>
</mapper>