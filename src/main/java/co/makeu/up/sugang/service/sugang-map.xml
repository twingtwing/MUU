<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.makeu.up.sugang.service.SugangMapper">
	<select id="sugangSelectList" parameterType="String" resultType="co.makeu.up.sugang.service.SugangVO">
		SELECT S.*, L.TTL, L.THUMB FROM 
		SUGANG S JOIN LECTURE L
		ON S.LT_NO = L.LT_NO 
		WHERE ID = #{id}
		AND TLSN_ST_CODE NOT IN ('SU03')
		ORDER BY S.EXP_DATE
	</select>
	<select id="sugangCheckDate" parameterType="co.makeu.up.sugang.service.SugangVO" resultType="co.makeu.up.sugang.service.SugangVO">		
		SELECT S.*,L.TTL,L.THUMB FROM SUGANG S JOIN LECTURE L
		ON S.LT_NO = L.LT_NO
		WHERE S.LT_NO=#{ltNo} 
		AND S.ID = #{id} 
		AND S.EXP_DATE>SYSDATE
		AND TLSN_ST_CODE='SU01'
	</select>
	<update id="sugangRefundUpdate" parameterType="Integer">
		UPDATE SUGANG 
		SET TLSN_ST_CODE = 'SU03'
		WHERE TLSN_NO = #{tlsnNo}
	</update>
	<select id="sugangBeforeRefund" resultType="Integer" parameterType="co.makeu.up.sugang.service.SugangVO">
		SELECT COUNT(*) CNT FROM SUGANG
        WHERE ID = #{id}
        AND REG_DATE > SYSDATE-7
        AND TLSN_NO= #{tlsnNo}
	</select>
	<select id="sugangPay" parameterType="co.makeu.up.sugang.service.SugangVO" resultType="co.makeu.up.sugang.service.SugangVO">
		SELECT S.*,L.TTL,L.INTRO,L.THUMB,L.KIT_NAME,L.KIT_INTRO,L.KIT_PRC
		FROM SUGANG S JOIN LECTURE L
		ON S.LT_NO = L.LT_NO
		WHERE ID = #{id}
	<if test="regDateSearch != null and expDateSearch != null">
		AND S.REG_DATE <![CDATA[>]]> #{regDateSearch}
        AND S.EXP_DATE <![CDATA[<]]> #{expDateSearch}
	</if>
		ORDER BY S.REG_DATE
	</select>
	<update id="updateSugangConfirm" parameterType="co.makeu.up.sugang.service.SugangVO">
		UPDATE SUGANG 
		SET SHIP_ST_CODE = #{shipStCode}
		WHERE TLSN_NO = #{tlsnNo}
	</update>
</mapper>